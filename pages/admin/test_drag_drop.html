<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drag & Drop Verification</title>
    <link href="https://unpkg.com/@phosphor-icons/web" rel="stylesheet">
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
            background: #f0f0f0;
        }

        .test-box {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .btn {
            padding: 8px 16px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .status {
            font-weight: bold;
            margin-left: 10px;
        }

        .pass {
            color: green;
        }

        .fail {
            color: red;
        }

        /* Styles required for Menu Manager */
        .glass-card {
            background: #fff;
            border: 1px solid #ddd;
            padding: 10px;
        }

        .menu-item {
            background: #f9f9f9;
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 5px;
            cursor: move;
        }

        .menu-item.dragging {
            opacity: 0.5;
        }
    </style>
</head>

<body>
    <h1>Drag & Drop Verification</h1>

    <div class="test-box">
        <h2>1. Manual Test</h2>
        <p>Drag "Item A" below "Item B". The order should update.</p>
        <div id="menu-items-list"></div>
        <button class="btn" onclick="resetItems()">Reset Items</button>
    </div>

    <div class="test-box">
        <h2>2. Logic Verification (Automated)</h2>
        <button class="btn" onclick="runLogicTest()">Run Reorder Test</button>
        <span id="logic-status" class="status"></span>
        <pre id="logic-log" style="background: #eee; padding: 10px; margin-top: 10px; display:none;"></pre>
    </div>

    <script src="assets/js/site-settings.js"></script>
    <script>
        // Setup initial state
        function resetItems() {
            if (!window.SiteSettings) return;

            // Override settings with test data
            SiteSettings._settings.header.menu = [
                { label: "Item A (0)", link: "#a", enabled: true },
                { label: "Item B (1)", link: "#b", enabled: true },
                { label: "Item C (2)", link: "#c", enabled: true }
            ];
            SiteSettings.renderMenuManager();
        }

        function runLogicTest() {
            const log = document.getElementById('logic-log');
            const status = document.getElementById('logic-status');
            log.style.display = 'block';
            log.textContent = "Starting logic test...\n";

            try {
                resetItems();
                log.textContent += "Initial: [A, B, C]\n";

                // Simulate reorder: Move index 0 (A) to index 2
                // Expected: [B, C, A] (depending on splice logic)
                log.textContent += "Action: Move Index 0 to 2\n";
                // Note: splice insertion usually inserts *before* the index if not careful, 
                // or *at* the index. Let's see SiteSettings implementation:
                // item = splice(from, 1)[0]
                // splice(to, 0, item)

                // Move 0 to 2: remove 0 (A), remaining [B, C]. Insert A at 2 -> [B, C, A]
                SiteSettings.reorderMenu(0, 2);

                const menu = SiteSettings._settings.header.menu;
                const labels = menu.map(m => m.label);
                log.textContent += "Result: " + JSON.stringify(labels) + "\n";

                if (labels[0].includes("B") && labels[2].includes("A")) {
                    status.textContent = "PASS";
                    status.className = "status pass";
                    log.textContent += "SUCCESS: Order changed correctly.\n";
                } else {
                    status.textContent = "FAIL";
                    status.className = "status fail";
                    log.textContent += "FAILURE: Order did not change as expected.\n";
                }

            } catch (e) {
                status.textContent = "ERROR";
                status.className = "status fail";
                log.textContent += "Error: " + e.message;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            // Wait for SiteSettings to init
            setTimeout(resetItems, 500);
        });
    </script>
</body>

</html>