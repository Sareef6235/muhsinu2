<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Integration Verification</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
            background: #f4f6f8;
        }

        .test-box {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .btn {
            padding: 8px 16px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .status {
            font-weight: bold;
            margin-left: 10px;
        }

        .pass {
            color: green;
        }

        .fail {
            color: red;
        }

        /* Mock Dashboard UI Elements */
        #header-settings-content,
        #footer-settings-content {
            border: 1px dashed #ccc;
            padding: 10px;
            margin-top: 10px;
        }

        .glass-card {
            background: #fff;
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 10px;
        }
    </style>
</head>

<body>
    <h1>Dashboard Integration Verification</h1>
    <p>Simulating User Interactions in the Admin Panel...</p>

    <!-- Mock Container for SiteSettings Editor -->
    <div id="header-settings-content"></div>
    <div id="footer-settings-content"></div>
    <div id="main-header"></div> <!-- Target for renderHeader -->
    <div id="main-footer"></div> <!-- Target for renderFooter -->

    <div class="test-box">
        <h2>1. Change Site Title</h2>
        <p>Action: Update title input -> Trigger Event -> Verify Header Update</p>
        <button class="btn" onclick="runTitleTest()">Run Title Test</button>
        <p>Status: <span id="title-status" class="status">Pending</span></p>
    </div>

    <div class="test-box">
        <h2>2. Add Menu Item</h2>
        <p>Action: Add Item -> Verify Menu List -> Verify Header Preview</p>
        <button class="btn" onclick="runMenuTest()">Run Menu Test</button>
        <p>Status: <span id="menu-status" class="status">Pending</span></p>
    </div>

    <div class="test-box">
        <h2>3. Save Changes</h2>
        <p>Action: Trigger Save -> Check LocalStorage</p>
        <button class="btn" onclick="runSaveTest()">Run Save Test</button>
        <p>Status: <span id="save-status" class="status">Pending</span></p>
    </div>

    <script src="assets/js/site-settings.js"></script>
    <script>
        // Initialize like dashboard would
        document.addEventListener('DOMContentLoaded', () => {
            if (window.SiteSettings) {
                SiteSettings.renderHeaderEditor();
                SiteSettings.renderFooterEditor();
                SiteSettings.render(); // Render actual header/footer
            }
        });

        function runTitleTest() {
            const statusEl = document.getElementById('title-status');
            const titleInput = document.getElementById('ss-title');

            if (!titleInput) {
                statusEl.textContent = "FAIL (Input not found)";
                statusEl.className = "status fail";
                return;
            }

            // Simulate user typing
            const testTitle = "Verified Title " + Date.now();
            titleInput.value = testTitle;

            // Trigger events that SiteSettings listens to
            titleInput.dispatchEvent(new Event('input'));
            titleInput.dispatchEvent(new Event('change'));

            setTimeout(() => {
                // Check internal state
                const internalMatch = SiteSettings._settings.header.title === testTitle;

                // Check DOM (Header Preview inside editor, or Main Header)
                // SiteSettings.renderHeader() updates #main-header
                const headerEl = document.querySelector('#main-header h1');
                const domMatch = headerEl && headerEl.textContent.trim() === testTitle;

                if (internalMatch && domMatch) {
                    statusEl.textContent = "PASS";
                    statusEl.className = "status pass";
                } else {
                    statusEl.textContent = `FAIL (Internal: ${internalMatch}, DOM: ${domMatch})`;
                    statusEl.className = "status fail";
                }
            }, 500);
        }

        function runMenuTest() {
            const statusEl = document.getElementById('menu-status');

            // Mock prompt
            const originalPrompt = window.prompt;
            window.prompt = (msg) => {
                if (msg.includes("label")) return "Test Item";
                if (msg.includes("link")) return "#test";
                return null;
            };

            const initialCount = SiteSettings._settings.header.menu.length;

            // Call add method directly as if button clicked
            SiteSettings.addMenuItem();

            window.prompt = originalPrompt; // Restore

            setTimeout(() => {
                const newCount = SiteSettings._settings.header.menu.length;
                const addedItem = SiteSettings._settings.header.menu[newCount - 1];

                if (newCount === initialCount + 1 && addedItem.label === "Test Item") {
                    statusEl.textContent = "PASS";
                    statusEl.className = "status pass";
                } else {
                    statusEl.textContent = "FAIL";
                    statusEl.className = "status fail";
                }
            }, 500);
        }

        function runSaveTest() {
            const statusEl = document.getElementById('save-status');

            // Force save
            const success = SiteSettings.save();

            // Check storage
            const stored = JSON.parse(localStorage.getItem('siteSettings'));
            const currentTitle = SiteSettings._settings.header.title;

            if (success && stored && stored.header.title === currentTitle) {
                statusEl.textContent = "PASS";
                statusEl.className = "status pass";
            } else {
                statusEl.textContent = "FAIL";
                statusEl.className = "status fail";
            }
        }
    </script>
</body>

</html>