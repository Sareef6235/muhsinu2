<!DOCTYPE html>
<html lang="ml">
<head>
<meta charset="UTF-8">
<title>Ultra Result System</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>

<style>
body{background:#eaeaea;font-family:Segoe UI}
.panel,.cert{width:900px;margin:20px auto;background:#fff;padding:20px}
.panel{border:2px dashed #333}
.cert{border:12px double #1e3c72}
.header{text-align:center}
.flex{display:flex;justify-content:space-between}
.photo{width:120px;height:140px;border:2px solid}
.pass{color:green;font-weight:bold}
.fail{color:red;font-weight:bold}
.grade{font-size:22px}
.footer{display:flex;justify-content:space-between;align-items:center;margin-top:40px}
</style>
</head>

<body>

<!-- ================= ADMIN PANEL ================= -->
<div class="panel">
<h2>Admin Control (Temporary)</h2>

Student:
<select id="studentSel" onchange="loadStudent()"></select>

<br><br>

Total Marks:
<select id="total" onchange="updatePassUI()">
<option>100</option>
<option>50</option>
</select>

<br><br>

Pass Method:
<select id="passType" onchange="updatePassUI()">
<option value="fixed">Fixed</option>
<option value="percent">Percentage</option>
</select>

<span id="passInput"></span>

<br><br>

Grade Model:
<select id="gradeModel">
<option value="normal">Normal</option>
<option value="relaxed">Relaxed</option>
<option value="strict">Strict</option>
</select>

<br><br>
<button onclick="applyAdmin()">Apply</button>
</div>

<!-- ================= CERTIFICATE ================= -->
<div class="cert" id="cert">

<div class="header">
<h1>ABC PUBLIC SCHOOL</h1>
<h3>Result Certificate / റിസൾട്ട് സർട്ടിഫിക്കറ്റ്</h3>
</div>

<div class="flex">
<div>
<p><b>Name / പേര്:</b> <span id="name"></span></p>
<p><b>Exam:</b> Final Exam</p>
<p><b>Total:</b> <span id="tm"></span></p>
<p><b>Marks:</b> <span id="om"></span></p>
<p class="grade">Grade: <span id="grade"></span></p>
<p id="status"></p>
</div>

<img id="photo" class="photo">
</div>

<div class="footer">
<div>
<div id="qr"></div>
<small>Scan to verify</small>
</div>

<div style="text-align:center">
<img src="signature.png" width="150"><br>
Principal
</div>
</div>

</div>

<center><button onclick="downloadPDF()">Download PDF</button></center>

<script>
/* ================= DATA ================= */
const students=[
{id:1,name:"Rahul S",marks:78,photo:"student1.jpg"},
{id:2,name:"Amina K",marks:42,photo:"student2.jpg"},
{id:3,name:"Arjun P",marks:91,photo:"student3.jpg"}
];

let total=100,passValue=35,passType="fixed",gradeModel="normal";
let current=students[0];

/* ================= INIT ================= */
students.forEach(s=>{
studentSel.innerHTML+=`<option value="${s.id}">${s.name}</option>`;
});

updatePassUI(); loadStudent();

/* ================= FUNCTIONS ================= */
function loadStudent(){
current=students.find(s=>s.id==studentSel.value);
render();
}

function updatePassUI(){
passType=passType=document.getElementById("passType").value;
passInput.innerHTML=passType=="fixed"
?`Pass Mark: <input id="passVal" value="35" size="3">`
:`Pass %: <input id="passVal" value="35" size="3">`;
}

function applyAdmin(){
total=+document.getElementById("total").value;
passType=document.getElementById("passType").value;
passValue=+document.getElementById("passVal").value;
gradeModel=document.getElementById("gradeModel").value;
render();
}

function gradeLogic(p){
const g={
normal:[90,80,70,60],
relaxed:[85,75,65,55],
strict:[95,85,75,65]
}[gradeModel];
if(p>=g[0])return"A+";
if(p>=g[1])return"A";
if(p>=g[2])return"B+";
if(p>=g[3])return"B";
return"C";
}

function render(){
name.innerText=current.name;
photo.src=current.photo;
tm.innerText=total;
om.innerText=current.marks;

let passMark=passType=="fixed"?passValue:(total*passValue/100);
let percent=current.marks/total*100;
let statusTxt=current.marks>=passMark?"PASS":"FAIL";
status.innerText=statusTxt;
status.className=statusTxt=="PASS"?"pass":"fail";
grade.innerText=statusTxt=="PASS"?gradeLogic(percent):"F";

qr.innerHTML="";
new QRCode(qr,{
text:`${current.id}|${current.name}|${current.marks}/${total}|${grade.innerText}|${statusTxt}`,
width:90,height:90
});
}

function downloadPDF(){
html2pdf().from(cert).set({scale:3,filename:"Result.pdf"}).save();
}
</script>

</body>
</html>
