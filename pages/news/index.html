<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News & Events | MHMV</title>
    <link rel="stylesheet" href="../../assets/css/styles.css">
    <link rel="stylesheet" href="../../assets/css/animations.css">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script type="module" src="../../assets/js/components/header.js"></script>
    <script type="module" src="../../assets/js/news-service.js"></script>
</head>

<body>
    <site-header></site-header>

    <main class="page-container" style="padding-top: 100px;">
        <div class="container">
            <h1 class="section-title">Latest Updates</h1>

            <div id="news-wrapper">
                <div class="loading-spinner"></div>
            </div>
        </div>
    </main>

    <script type="module">
        import { NewsService } from '../../assets/js/news-service.js';

        async function init() {
            const container = document.getElementById('news-wrapper');
            const params = new URLSearchParams(window.location.search);
            const id = params.get('id');

            if (id) {
                // Detail view
                const all = await new NewsService().getAllNews(); // or getById
                const item = all.find(n => n.id === id);

                if (item) {
                    const lang = document.documentElement.lang || 'en';
                    const title = item.title[lang] || item.title.en;
                    container.innerHTML = `
                         <a href="index.html" class="btn-text"><i class="ph ph-arrow-left"></i> Back to News</a>
                         <article class="news-detail animate-fade-up" style="max-width: 800px; margin: 20px auto;">
                            ${item.image ? `<img src="${item.image}" style="width:100%; border-radius:15px; margin-bottom:20px;">` : ''}
                            <div class="meta" style="color:#666; margin-bottom:10px;">${new Date(item.date).toLocaleDateString()}</div>
                            <h1>${title}</h1>
                            <div class="content" style="font-size:1.1rem; line-height:1.8; margin-top:20px;">
                                ${item.shortDesc} <!-- Expand if full content exists -->
                            </div>
                         </article>
                    `;
                }
            } else {
                // List view
                const news = await new NewsService().getPublishedNews();
                if (news.length === 0) {
                    container.innerHTML = "No updates yet.";
                    return;
                }

                container.innerHTML = `<div class="news-grid">
                    ${news.map(n => {
                    const title = n.title.en || n.title; // simple fallback
                    return `
                            <div class="news-card-premium animate-fade-up" onclick="window.location.href='?id=${n.id}'">
                                <div class="img-wrapper">
                                     ${n.image ? `<img src="${n.image}">` : `<div style="height:100%; background:#222;"></div>`}
                                </div>
                                <div style="padding:20px;">
                                    <div style="font-size:0.8rem; color:var(--primary-color); margin-bottom:5px;">${new Date(n.date).toLocaleDateString()}</div>
                                    <h3>${title}</h3>
                                    <p>${n.shortDesc.substring(0, 100)}...</p>
                                </div>
                            </div>
                        `;
                }).join('')}
                </div>`;
            }
        }
        init();
    </script>
</body>

</html>