<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News & Updates | MIFTHAHUL HUDA</title>

    <!-- Unified Assets -->
    <link rel="stylesheet" href="../../assets/css/main.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <style>
        .news-hero {
            padding: 80px 0 40px;
            text-align: center;
        }

        .grid {
            display: grid;
            gap: 30px;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        }

        .lang-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            color: #fff;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.3s;
        }

        .lang-btn.active {
            background: var(--primary-color);
            color: #000;
            font-weight: 700;
        }

        .news-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border);
            border-radius: 20px;
            overflow: hidden;
            transition: 0.3s;
            cursor: pointer;
        }

        .news-card:hover {
            transform: translateY(-10px);
            border-color: var(--primary-color);
        }

        .news-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 20px 80px;
        }

        .news-featured-img {
            width: 100%;
            height: auto;
            border-radius: 20px;
            margin-bottom: 40px;
            border: 1px solid var(--border);
        }
    </style>

    <script type="module">
        import AppState from '../../assets/js/state.js';
        import NavigationSystem from '../../assets/js/navigation.js';
        import FooterSystem from '../../assets/js/footer.js';
        import { NewsService } from '../../assets/js/news-service.js';

        document.addEventListener('DOMContentLoaded', () => {
            AppState.init();
            NavigationSystem.init(AppState.navigation.menuData);
            FooterSystem.init();
            render();
        });

        const newsService = new NewsService();
        const mainContent = document.getElementById('main-content');
        let currentLang = 'en';

        const params = new URLSearchParams(window.location.search);
        const newsId = params.get('id');

        window.switchNewsLang = (lang) => {
            currentLang = lang;
            render();
        };

        function render() {
            if (!newsId) renderArchive();
            else {
                const article = newsService.getNewsById(newsId);
                article ? renderArticle(article) : render404();
            }
        }

        function renderArchive() {
            const news = newsService.getPublishedNews();
            mainContent.innerHTML = `
                <div class="news-hero container">
                    <h1 style="font-size: 3.5rem; font-weight: 800; background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Latest Updates</h1>
                    <div style="margin-top: 30px; display: flex; justify-content: center; gap: 10px;">
                        <button class="lang-btn ${currentLang === 'en' ? 'active' : ''}" onclick="switchNewsLang('en')">English</button>
                        <button class="lang-btn ${currentLang === 'ml' ? 'active' : ''}" onclick="switchNewsLang('ml')">Malayalam</button>
                        <button class="lang-btn ${currentLang === 'ar' ? 'active' : ''}" onclick="switchNewsLang('ar')">Arabic</button>
                    </div>
                </div>
                <div class="container" style="padding-bottom: 100px;">
                    <div class="grid">
                        ${news.map((item, idx) => {
                const title = (item.title && item.title[currentLang]) || item.title.en;
                const date = new Date(item.date).toLocaleDateString();
                return `
                                <article class="news-card animate-fade-up" style="animation-delay: ${idx * 0.1}s" onclick="window.location.href='index.html?id=${item.id}'">
                                    <div style="height: 200px; background: #111;">
                                        ${item.image ? `<img src="../../${item.image}" style="width: 100%; height: 100%; object-fit: cover;">` : ''}
                                    </div>
                                    <div style="padding: 25px;">
                                        <span style="color: var(--primary-color); font-size: 0.8rem; font-weight: 700;">${date}</span>
                                        <h3 style="margin-top: 10px;">${title}</h3>
                                    </div>
                                </article>
                            `;
            }).join('')}
                    </div>
                </div>
            `;
        }

        function renderArticle(item) {
            const title = (item.title && item.title[currentLang]) || item.title.en;
            const content = (item.fullContent && item.fullContent[currentLang]) || item.fullContent.en;
            mainContent.innerHTML = `
                <div class="news-container">
                    <button class="nav-link" onclick="window.location.href='index.html'" style="margin-bottom: 30px; border: none; background: transparent; color: var(--primary-color); cursor: pointer;"><i class="ph ph-arrow-left"></i> BACK TO NEWS</button>
                    <header style="margin-bottom: 40px;">
                        <h1 style="font-size: 3rem; margin-bottom: 15px;">${title}</h1>
                        <p style="color: var(--primary-color); font-weight: 600;">${new Date(item.date).toLocaleDateString()}</p>
                    </header>
                    ${item.image ? `<img src="../../${item.image}" class="news-featured-img">` : ''}
                    <div class="news-content" style="font-size: 1.15rem; line-height: 1.8; color: #ccc;">${content}</div>
                </div>
            `;
        }

        function render404() {
            mainContent.innerHTML = `<div class="container" style="text-align: center; padding: 100px 0;"><h2>Notice Not Found</h2></div>`;
        }
    </script>
</head>

<body>
    <header id="site-header"></header>
    <div id="site-breadcrumbs"></div>
    <main id="main-content">
        <div style="text-align: center; padding: 100px 0;"><i class="ph ph-spinner animate-spin"
                style="font-size: 3rem;"></i></div>
    </main>
    <footer id="site-footer"></footer>
</body>

</html>