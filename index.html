<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MHMV | Excellence in Education</title>
    <!-- CSS -->
    <link rel="stylesheet" href="assets/css/styles.css">
    <link rel="stylesheet" href="assets/css/modern-nav.css">
    <link rel="stylesheet" href="assets/css/animations.css">
    <!-- Icons & Animation Libs -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

    <!-- New Components -->
    <script type="module" src="assets/js/components/header.js"></script>
</head>

<body>

    <!-- 1. Universal Header -->
    <site-header></site-header>

    <!-- 2. Hero Section (Pre-existing/Modernized) -->
    <section id="home" class="hero-section">
        <div class="hero-bg">
            <div class="circle circle-1"></div>
            <div class="circle circle-2"></div>
        </div>
        <div class="container hero-content animate-fade-in-up">
            <h1>Empowering Minds<br><span>Shaping Futures</span></h1>
            <p>Providing quality education with a blend of traditional values and modern excellence.</p>
            <div class="btn-group">
                <a href="#services" class="btn btn-primary">Our Programs</a>
                <a href="pages/contact/index.html" class="btn btn-secondary">Contact Us</a>
            </div>
        </div>
    </section>

    <!-- 3. Dynamic News Ticker (Hidden by default, shown by JS) -->
    <section id="news-ticker" class="news-ticker-section" style="display:none;">
        <div class="container">
            <div class="ticker-wrapper">
                <span class="ticker-label">LATEST:</span>
                <div class="ticker-content" id="news-ticker-content">
                    <!-- Injected via JS -->
                </div>
            </div>
        </div>
    </section>

    <!-- 4. Stats / Counter Section (Dynamic) -->
    <section id="stats" class="section bg-accent">
        <div class="container">
            <div id="stats-container" class="stats-grid">
                <!-- Injected via JS -->
            </div>
        </div>
    </section>

    <!-- 5. Services Grid (Dynamic) -->
    <section id="services" class="services-section">
        <div class="container">
            <div class="section-header text-center">
                <h2>Our Services</h2>
                <div class="divider mx-auto"></div>
                <p>Discover what we offer to our students and community.</p>
            </div>
            <div id="services-grid" class="services-grid">
                <div class="loading-spinner"></div>
            </div>
            <div style="text-align: center; margin-top: 40px;">
                <a href="pages/services/index.html" class="btn btn-secondary">View All Services</a>
            </div>
        </div>
    </section>

    <!-- 6. About Section with Dynamic Results Highlight -->
    <section id="about" class="about-section">
        <div class="container">
            <div class="row about-grid">
                <div class="col-md-6">
                    <div class="img-wrapper-modern" style="position: relative; border-radius: 20px; overflow: hidden;">
                        <img src="assets/images/about.jpg" alt="About Us" style="width: 100%; object-fit: cover;">
                        <!-- Dynamic Results Card Injection Point -->
                        <div id="results-card-container"></div>
                    </div>
                </div>
                <div class="col-md-6 content-center">
                    <span class="sub-heading"
                        style="color: var(--secondary-color); font-weight: 600; letter-spacing: 1px;">ABOUT US</span>
                    <h2 class="section-title">Mifthahul Huda Madrasa</h2>
                    <p style="font-size: 1.1rem; line-height: 1.8; color: #ccc; margin-bottom: 30px;">
                        Dedicated to fostering a learning environment where academic excellence matches moral growth.
                        We leverage modern technology to enhance the learning experience, offering a curriculum that
                        balances religious studies with contemporary skills.
                    </p>
                    <ul class="feature-list" style="margin-bottom: 30px;">
                        <li style="margin-bottom: 10px;"><i class="ph ph-check-circle"
                                style="color: var(--primary-color); margin-right: 10px;"></i> Modern Smart Classrooms
                        </li>
                        <li style="margin-bottom: 10px;"><i class="ph ph-check-circle"
                                style="color: var(--primary-color); margin-right: 10px;"></i> Comprehensive Islamic
                            Studies</li>
                        <li style="margin-bottom: 10px;"><i class="ph ph-check-circle"
                                style="color: var(--primary-color); margin-right: 10px;"></i> Extracurricular Activities
                        </li>
                    </ul>
                    <a href="pages/about/index.html" class="btn btn-primary">Learn More</a>
                </div>
            </div>
        </div>
    </section>

    <!-- 7. Testimonials Section (Dynamic) -->
    <section id="testimonials" class="section" style="background: linear-gradient(180deg, #0a0a0a 0%, #111 100%);">
        <div class="container">
            <h2 class="section-title" style="text-align: center;">Community Voices</h2>
            <div id="testimonials-grid" class="testimonials-grid" style="margin-top: 40px;">
                <!-- Injected via JS -->
            </div>
        </div>
    </section>

    <!-- 8. Gallery Highlight Section -->
    <section id="gallery-preview" class="section">
        <div class="container">
            <div style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 30px;">
                <h2 class="section-title" style="margin: 0;">Campus Life</h2>
                <a href="pages/gallery/index.html" class="btn-text">View Full Gallery <i
                        class="ph ph-arrow-right"></i></a>
            </div>
            <div class="gallery-grid" id="home-gallery-grid"
                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                <!-- Injected via JS -->
            </div>
        </div>
    </section>

    <!-- 9. Contact / CTA Section -->
    <section id="contact-cta" class="section"
        style="background: url('assets/images/cta-bg.jpg') center/cover; position: relative;">
        <div class="overlay" style="position: absolute; inset: 0; background: rgba(0,0,0,0.8);"></div>
        <div class="container" style="position: relative; z-index: 2; text-align: center; padding: 60px 20px;">
            <h2 style="font-size: 2.5rem; margin-bottom: 20px;">Ready to Join Us?</h2>
            <p style="font-size: 1.2rem; color: #ccc; max-width: 600px; margin: 0 auto 30px;">Admissions are open for
                the upcoming academic year. Contact us today to secure a spot.</p>
            <a href="pages/contact/index.html" class="btn btn-primary btn-lg">Get in Touch</a>
        </div>
    </section>

    <!-- Footer -->
    <footer id="main-footer">
        <!-- SiteFooter.js / or static footer -->
    </footer>

    <!-- Scripts -->
    <script type="module" src="assets/js/site-footer.js"></script>
    <script type="module">
        import { ServicesCMS } from './assets/js/services-cms.js';
        import { NewsService } from './assets/js/news-service.js';
        import { GalleryManager } from './assets/js/modules/gallery.js';
        import { StatsCMS } from './assets/js/modules/stats-cms.js';
        import { TestimonialsCMS } from './assets/js/modules/testimonials-cms.js';
        import { ResultsManager } from './assets/js/modules/results-manager.js';

        async function initHome() {

            // 1. Load Services (Limit to 3)
            try {
                const services = await ServicesCMS.getAll();
                const grid = document.getElementById('services-grid');
                if (grid && services.length > 0) {
                    grid.innerHTML = services.filter(s => s.visible !== false).slice(0, 3).map(s => {
                        const content = s.content.en || s.content;
                        return `
                        <div class="service-card animate-on-scroll">
                            <i class="${s.icon} service-icon"></i>
                            <h3>${content.title}</h3>
                            <p>${content.shortDesc || ''}</p>
                            <a href="pages/services/index.html?id=${s.id}" class="read-more">Read More <i class="ph ph-arrow-right"></i></a>
                        </div>
                    `;
                    }).join('');
                }
            } catch (e) { console.error("Err loading services", e); }

            // 2. Load Latest News
            try {
                const news = await new NewsService().getLatestNews(3); // Fetch more for ticker
                if (news.length > 0) {
                    const ticker = document.getElementById('news-ticker');
                    if (ticker) ticker.style.display = 'block';

                    const tickerContent = document.getElementById('news-ticker-content');
                    if (tickerContent) {
                        const links = news.map(n =>
                            `<a href="pages/news/index.html?id=${n.id}" style="margin-right: 50px;">${n.title.en || n.title} - ${new Date(n.date).toLocaleDateString()}</a>`
                        ).join('');
                        tickerContent.innerHTML = links;
                    }
                }
            } catch (e) { console.error("Err loading news", e); }

            // 3. Load Stats
            try {
                const stats = await StatsCMS.getAll();
                const statsContainer = document.getElementById('stats-container');
                if (statsContainer && stats.length > 0) {
                    statsContainer.innerHTML = stats.map(st => `
                        <div class="stat-item animate-on-scroll">
                            <span class="stat-value" style="background: linear-gradient(135deg, #fff, ${st.color || 'var(--primary-color)'}); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">${st.value}</span>
                            <span class="stat-label">${st.label}</span>
                        </div>
                    `).join('');
                }
            } catch (e) { console.error("Err loading stats", e); }

            // 4. Load Testimonials
            try {
                const testimonials = await TestimonialsCMS.getAll();
                const tGrid = document.getElementById('testimonials-grid');
                if (tGrid && testimonials.length > 0) {
                    tGrid.innerHTML = testimonials.filter(t => t.active).slice(0, 3).map(t => `
                        <div class="testimonial-card animate-on-scroll">
                            <div class="star-rating">${'â˜…'.repeat(t.rating)}</div>
                            <p class="testimonial-quote">${t.content}</p>
                            <div class="testimonial-author">
                                <div class="author-avatar">${t.name.charAt(0)}</div>
                                <div class="author-info">
                                    <h4>${t.name}</h4>
                                    <span>${t.role}</span>
                                </div>
                            </div>
                        </div>
                    `).join('');
                }
            } catch (e) { console.error("Err loading testimonials", e); }

            // 5. Load Result Highlight
            try {
                const resultMeta = await ResultsManager.getHighlight();
                const rContainer = document.getElementById('results-card-container');
                if (rContainer && resultMeta.active) {
                    rContainer.innerHTML = `
                        <div class="results-card animate-on-scroll">
                            <h4>${resultMeta.title}</h4>
                            <p style="margin: 5px 0 10px; font-size: 0.85rem; color: #ccc;">${resultMeta.subtitle}</p>
                            <a href="${resultMeta.linkUrl}" class="btn-text" style="color: #fff; text-decoration: underline;">${resultMeta.linkText}</a>
                        </div>
                    `;
                }
            } catch (e) { console.error("Err loading results", e); }

            // 6. Load Gallery Preview
            try {
                const gallery = await GalleryManager.getAll();
                const gGrid = document.getElementById('home-gallery-grid');
                if (gGrid && gallery.length > 0) {
                    gGrid.innerHTML = gallery.slice(0, 4).map(item => `
                    <div style="height: 200px; border-radius: 10px; overflow: hidden; position: relative;">
                         ${item.type === 'video' ? '<div style="position:absolute; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,0.3);"><i class="ph ph-play-circle" style="font-size:3rem; color:#fff;"></i></div>' : ''}
                         <img src="${item.src}" loading="lazy" style="width:100%; height:100%; object-fit: cover; transition: transform 0.5s ease;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">
                    </div>
                `).join('');
                }
            } catch (e) { console.error("Err loading gallery", e); }

            // Init Animations
            if (window.gsap && window.ScrollTrigger) {
                gsap.registerPlugin(ScrollTrigger);
                setTimeout(() => {
                    gsap.utils.toArray('.animate-on-scroll').forEach(el => {
                        gsap.from(el, {
                            scrollTrigger: { trigger: el, start: "top 85%" },
                            y: 50, opacity: 0, duration: 0.8, ease: "power2.out"
                        });
                    });
                }, 500); // Small delay to ensure DOM is populated
            }
        }

        document.addEventListener('DOMContentLoaded', initHome);
    </script>
</body>

</html>